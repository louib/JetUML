app-id: "org.jetuml.JetUML"
runtime: "org.freedesktop.Platform"
runtime-version : "20.08"
sdk: "org.freedesktop.Sdk"
sdk-extensions : [
  "org.freedesktop.Sdk.Extension.openjdk11"
]
command: "/app/bin/launch_jetuml"
finish-args: [
    "--socket=x11",
    "--share=ipc",
    "--device=dri",
    "--filesystem=home",
    "--env=PATH=/app/jre/bin:/usr/bin"
]
cleanup-commands: []
cleanup: []
modules:
  -
    name : "openjdk"
    buildsystem : "simple"
    build-commands :
      - /usr/lib/sdk/openjdk11/install.sh
  -
    name: "JavaFX"
    buildsystem: "simple"
    builddir: true
    build-commands:
      - mkdir -p /app/javafx
      - cp -r ./ /app/javafx
    sources:
      -
        md5: "98d5d52df541dcc423e3e3b8bb0ab90d"
        type: "archive"
        url: "https://download2.gluonhq.com/openjfx/11.0.2/openjfx-11.0.2_linux-x64_bin-sdk.zip"
  -
    name: "launch-script"
    buildsystem: "simple"
    builddir: true
    build-commands: []
    post-install:
      - mkdir -p /app/bin/jetuml
      - cp launch_jetuml /app/bin/
      - chmod +x /app/bin/launch_jetuml
    sources:
      -
        type: "script"
        dest-filename: "launch_jetuml"
        commands:
          - java -cp /app/bin/jetuml -p /app/javafx/lib --add-modules javafx.controls,javafx.swing ca.mcgill.cs.jetuml.JetUML
  -
    name: "JetUML"
    buildsystem: "simple"
    builddir: true
    build-commands:
      - mkdir -p bin/jetuml
      - cp -r icons/** bin/jetuml/
      - cp -r tipdata/** bin/jetuml/
      - find src/ -name '*.java' > files.txt
      - /usr/lib/sdk/openjdk11/bin/javac -cp src -p /app/javafx/lib --add-modules javafx.controls,javafx.swing -d bin/jetuml @files.txt
      - cd src; cp --parent `find -name '*.css'` ../bin/jetuml
      - cd src; cp --parent `find -name '*.properties'` ../bin/jetuml
      - mkdir -p /app/bin/jetuml
      - cp -R bin/jetuml/* /app/bin/jetuml
    sources:
      -
        type: "git"
        url: "https://github.com/prmr/JetUML.git"
        tag: "v3.3"
        commit: "8c6121cf4a966946abdb9b54404e6d9570cf782c"
      -
        type: "patch"
        path: "./compile_without_junit.patch"
